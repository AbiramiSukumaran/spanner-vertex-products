<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Catalog Search</title>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Custom CSS (optional - for overrides) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        /* Optional: Override any default Tailwind styles here */
        .product-meta div {
            margin-bottom: 0.25rem; /* Adds a small space between meta data items */
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-6 md:p-8 lg:p-10">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-blue-700 mb-2">Product Catalog Search</h1>
            <p class="text-gray-600">Find the perfect product for your needs.</p>
        </header>

        <!-- Search Section -->
        <section class="mb-8">
            <div class="flex flex-col md:flex-row gap-2">
                <input
                    type="text"
                    id="search-box"
                    placeholder="Enter your search query..."
                    class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline md:flex-grow"
                />
                <button onclick="performSearch()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Search</button>

            </div>
             <button onclick="clearSearchAndResults()" class="mt-2 text-sm text-gray-500 hover:text-gray-700 focus:outline-none">Clear Search & Results</button>

        </section>

        <!-- Search Results -->
        <section id="search-results" class="mt-6">
            <!-- Results will be loaded here -->
        </section>

        <!-- Add Product Form -->
        <section class="mt-12">
            <h2 class="text-2xl font-semibold text-green-700 mb-4 text-center">Add New Product</h2>
            <form id="add-product-form" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <!-- Product Name -->
                <div class="mb-4">
                    <label for="name" class="block text-gray-700 text-sm font-bold mb-2">Name:</label>
                    <input type="text" id="name" name="name" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>

                <!-- Product Description -->
                <div class="mb-4">
                    <label for="description" class="block text-gray-700 text-sm font-bold mb-2">Description:</label>
                    <textarea id="description" name="description" rows="3" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"></textarea>
                </div>

                <!-- Product Brand -->
                <div class="mb-4">
                    <label for="brand" class="block text-gray-700 text-sm font-bold mb-2">Brand:</label>
                    <input type="text" id="brand" name="brand" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>

                <!-- Product Category -->
                <div class="mb-4">
                    <label for="category" class="block text-gray-700 text-sm font-bold mb-2">Category:</label>
                    <input type="text" id="category" name="category" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>

                <!-- Product Price & Currency -->
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="price" class="block text-gray-700 text-sm font-bold mb-2">Price:</label>
                        <input type="number" id="price" name="price" step="0.01" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>
                    <div>
                        <label for="currency" class="block text-gray-700 text-sm font-bold mb-2">Currency:</label>
                        <input type="text" id="currency" name="currency" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>
                </div>

                <!-- Product Availability & Region -->
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="availability" class="block text-gray-700 text-sm font-bold mb-2">Availability:</label>
                        <input type="number" id="availability" name="availability" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>
                    <div>
                        <label for="region" class="block text-gray-700 text-sm font-bold mb-2">Region:</label>
                        <input type="text" id="region" name="region" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>
                </div>

                <!-- Add Product Button -->
                <div class="flex items-center justify-between">
                    <button type="button" onclick="addProduct()" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Add Product</button>
                    <div id="add-product-message" class="text-sm"></div>
                </div>
            </form>
        </section>

        <!-- Footer -->
        <footer class="text-center mt-8 text-gray-500">
            <p>&copy; 2024 Product Catalog. All rights reserved.</p>
        </footer>
    </div>

    <script>
        async function performSearch() {
            const queryInput = document.getElementById('search-box');
            const resultsDiv = document.getElementById('search-results');
            const query = queryInput.value.trim();

            if (!query) {
                resultsDiv.innerHTML = '<p>Please enter a search term.</p>';
                return;
            }

            resultsDiv.innerHTML = '<p>Searching...</p>'; // Show loading indicator

            try {
                const response = await fetch(`/search?q=${encodeURIComponent(query)}`);
                const data = await response.json();

                if (response.ok) {
                    displayResults(data);
                } else {
                    resultsDiv.innerHTML = `<p>Error: ${data.error || response.statusText}</p>`;
                }
            } catch (error) {
                console.error('Error fetching search results:', error);
                resultsDiv.innerHTML = `<p>An error occurred while fetching results.</p>`;
            }
        }

        function displayResults(products) {
            const resultsDiv = document.getElementById('search-results');
            resultsDiv.innerHTML = ''; // Clear previous results

            if (products.length === 0) {
                resultsDiv.innerHTML = '<p>No products found matching your query.</p>';
                return;
            }

            products.forEach(product => {
                const productElement = document.createElement('div');
                productElement.classList.add('bg-white', 'rounded-lg', 'shadow-md', 'p-4', 'mb-4');

                productElement.innerHTML = `
                    <h3 class="text-xl font-semibold text-gray-800">${product.Name}</h3>
                    <p class="text-gray-700">${product.Description || 'No description available.'}</p>
                    <div class="product-meta text-sm text-gray-500 mt-2">
                        <div><strong>Brand:</strong> ${product.Brand || 'N/A'}</div>
                        <div><strong>Category:</strong> ${product.Category || 'N/A'}</div>
                        <div><strong>Price:</strong> ${product.Currency || ''} ${product.Price !== null ? product.Price.toLocaleString() : 'N/A'}</div>
                        <div><strong>Availability:</strong> ${product.Availability !== null ? product.Availability.toLocaleString() : 'N/A'} (${product.Region || 'N/A'})</div>
                    </div>
                `;
                resultsDiv.appendChild(productElement);
            });
        }

        function clearSearchAndResults() {
            const searchInput = document.getElementById('search-box');
            const resultsDiv = document.getElementById('search-results');

            searchInput.value = ''; // Clear the search input
            resultsDiv.innerHTML = ''; // Clear the content of the results div
        }

        async function addProduct() {
            const form = document.getElementById('add-product-form');
            const messageDiv = document.getElementById('add-product-message');
            const formData = new FormData(form);

            try {
                const response = await fetch('/api/products', {  // Changed route to API endpoint
                    method: 'POST',
                    body: formData,
                });

                const data = await response.json();

                if (response.ok) {
                    messageDiv.textContent = `Product added successfully!`; // Show product id
                    messageDiv.classList.add('text-green-500'); // Add a class for styling (e.g., green text)
                    messageDiv.classList.remove('text-red-500'); // Remove error class, if present
                    form.reset(); // Clear the form
                } else {
                    messageDiv.textContent = `Error: ${data.error || response.statusText}`;
                    messageDiv.classList.add('text-red-500');   // Add a class for styling (e.g., red text)
                    messageDiv.classList.remove('text-green-500'); // Remove success class, if present
                }
            } catch (error) {
                console.error('Error adding product:', error);
                messageDiv.textContent = 'An error occurred while adding the product.';
                messageDiv.classList.add('text-red-500');
                messageDiv.classList.remove('text-green-500');
            }
        }
    </script>
</body>
</html>
